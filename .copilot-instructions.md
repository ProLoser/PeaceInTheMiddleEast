# Copilot Instructions for PeaceInTheMiddleEast

## Project Context

This is an **Open Source Backgammon** project built as a passion side project to connect Turkish and Israeli sides of a family through common hobbies. The project serves as a testing ground for the latest AI tools and aims to enable meaningful conversations across generations.

**Live URL**: https://backgammon.family  
**Repository**: https://github.com/ProLoser/PeaceInTheMiddleEast

## Technology Stack

- **Frontend**: React 18 + TypeScript
- **Build Tool**: Vite with Hot Module Replacement
- **Backend**: Firebase (Auth, Realtime Database, Functions, Messaging)
- **Internationalization**: i18next with automatic language detection
- **Styling**: CSS with CSS custom properties (CSS variables), Material Design Icons
- **PWA**: Progressive Web App with Vite PWA plugin
- **Monitoring**: Sentry for error tracking and performance monitoring
- **Package Manager**: Yarn (with workspaces for Firebase functions)

## Code Architecture & Patterns

### File Structure
```
src/
├── Types.ts           # TypeScript type definitions
├── Utils.ts           # Game logic and utility functions
├── firebase.config.ts # Firebase configuration
├── i18n.ts           # Internationalization setup
├── instrument.ts     # Sentry monitoring setup
├── Board/            # Game board components
│   ├── Dice.tsx
│   ├── Point.tsx
│   ├── Piece.tsx
│   └── Toolbar.tsx
└── Dialogues/        # Modal dialogues (Login, Chat, Profile, etc.)
```

### Key Components & Patterns

1. **Game State Management**: Uses Firebase Realtime Database for real-time multiplayer state
2. **Type Safety**: Strong TypeScript usage with enums for game states (`Color`, `Status`, `Modal`)
3. **Internationalization**: Full i18n support with React i18next, language auto-detection
4. **Firebase Integration**: Uses Firebase v9 compat mode for auth, database, and messaging
5. **PWA Features**: Service worker, offline support, push notifications

## Coding Guidelines

### TypeScript
- Use strict TypeScript configuration
- Prefer enums for constants (`Color`, `Status`, `Modal`)
- Use proper typing for Firebase snapshots (`SnapshotOrNullType`)
- Export types from `Types.ts` and import where needed

### React Patterns
- Use functional components with hooks
- Prefer `useCallback` and `useMemo` for performance optimization
- Use React Context for global state (Dialogues, Chat)
- Components use PascalCase, files use PascalCase.tsx

### CSS/Styling
- Use CSS custom properties (CSS variables) defined in `:root`
- Follow the existing design system with primary/secondary colors
- Use `.material-icons-svg` class for Material Design icons
- Responsive design with mobile-first approach
- Use `[onPointerUp]` selector for interactive elements

### Firebase Integration
- Use Firebase v9 compat mode (`firebase/compat/app`)
- Real-time listeners for game state synchronization
- Proper cleanup of Firebase listeners in useEffect
- FCM token management for push notifications

### Game Logic
- Game calculations in `Utils.ts` with pure functions
- Immutable state updates for game board
- Proper handling of backgammon rules (prison, home, dice)
- Audio feedback for game actions

## Internationalization

- All user-facing text must be translatable using `useTranslation()` hook
- Translation keys should be descriptive (e.g., `t('reportBug')`, `t('login')`)
- Support for RTL languages and locale-specific formatting
- Language detection from browser settings with fallback to English

## Development Workflow

### Scripts
- `yarn start` - Development server with HMR
- `yarn build` - Production build
- `yarn lint` - ESLint with TypeScript rules
- `yarn functions` - Deploy Firebase functions

### AI Tools Testing
This project is used to test various AI tools:
- GitHub Copilot ✓
- GitHub Codespaces ✓
- Cursor ✓
- ChatGPT ✓
- Google AI Studio ✓
- Amazon Q ✓
- Firebase Studio ✓

## Common Tasks

### Adding New Game Features
1. Update types in `Types.ts` if needed
2. Add game logic to `Utils.ts` with proper type safety
3. Update UI components in `Board/` directory
4. Add translations for new text
5. Test with Firebase real-time synchronization

### Adding New Dialogues/Modals
1. Create component in `Dialogues/` directory
2. Add modal type to `Modal` enum in `Types.ts`
3. Update `Dialogues/index.tsx` to include new modal
4. Add CSS file with same name as component
5. Ensure proper keyboard navigation and accessibility

### Firebase Updates
1. Test in Firebase emulator when possible
2. Update security rules if database structure changes
3. Handle authentication state changes properly
4. Clean up listeners to prevent memory leaks

## Error Handling

- Use Sentry for error tracking and performance monitoring
- Proper error boundaries for React components
- Handle Firebase errors gracefully (network issues, permission errors)
- Provide user-friendly error messages with internationalization

## Performance Considerations

- Optimize Firebase queries (use indexes, limit data)
- Lazy load components when appropriate
- Use React.memo for expensive components
- Optimize images and audio assets
- PWA caching strategy for offline experience

## Accessibility

- Use semantic HTML elements
- Proper ARIA labels for interactive elements
- Support keyboard navigation
- Consider users with different abilities and devices
- Test with screen readers when adding new features

Remember: This project bridges cultures through gaming - consider the international audience and diverse user needs in all development decisions.